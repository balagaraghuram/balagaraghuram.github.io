<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hospital Activity vs Weather Patterns</title>
    <!-- Load Plotly.js -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
    <h1 style="text-align: center;">Influence of Weather on Hospital Activity</h1>
    <h3 style="text-align: center; color: gray;">Project idea credited to Prof. Hui Li, Department of Mathematics, University of Birmingham</h3>

    <div style="text-align: center; margin-bottom: 20px;">
        <label for="fileUpload" style="font-size: 18px;">Upload Your Data File (CSV Format):</label>
        <input type="file" id="fileUpload" accept=".csv" style="margin-left: 10px;">
    </div>

    <div id="plot" style="width: 100%; height: 600px;"></div>

    <script>
        // Placeholder synthetic data
        let dates = [];
        let temperature = [];
        let rainfall = [];
        let edAdmissions = [];
        let icuAdmissions = [];

        function generateSyntheticData() {
            const startDate = new Date("2024-01-01");
            const endDate = new Date("2024-12-31");
            let currentDate = startDate;

            while (currentDate <= endDate) {
                dates.push(currentDate.toISOString().split('T')[0]); // Format date as YYYY-MM-DD
                temperature.push(Math.random() * 30); // Random temperature (0-30°C)
                rainfall.push(Math.random() * 50); // Random rainfall (0-50 mm)
                edAdmissions.push(Math.floor(Math.random() * 100)); // Random ED admissions
                icuAdmissions.push(Math.floor(Math.random() * 20)); // Random ICU admissions
                currentDate.setDate(currentDate.getDate() + 1); // Increment by 1 day
            }
        }

        function renderPlot() {
            const trace = {
                x: temperature,
                y: edAdmissions,
                mode: "markers",
                marker: {
                    size: rainfall.map(r => Math.sqrt(r) * 5), // Scale marker size by rainfall
                    color: icuAdmissions,
                    colorscale: "Viridis",
                    colorbar: { title: "ICU Admissions" },
                    showscale: true
                },
                text: dates.map((date, i) => 
                    `Date: ${date}<br>Temperature: ${temperature[i].toFixed(1)}°C<br>Rainfall: ${rainfall[i].toFixed(1)} mm<br>ED Admissions: ${edAdmissions[i]}<br>ICU Admissions: ${icuAdmissions[i]}`),
                hoverinfo: "text"
            };

            const layout = {
                title: "Hospital Admissions vs Weather Patterns",
                xaxis: { title: "Temperature (°C)" },
                yaxis: { title: "Emergency Department Admissions" },
                template: "plotly_white",
                hovermode: "closest"
            };

            Plotly.newPlot("plot", [trace], layout);
        }

        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    const csvData = e.target.result;
                    processData(csvData);
                };
                reader.readAsText(file);
            }
        }

        function processData(csvData) {
            const rows = csvData.split("\n").slice(1); // Skip header
            dates = [];
            temperature = [];
            rainfall = [];
            edAdmissions = [];
            icuAdmissions = [];

            rows.forEach(row => {
                const cols = row.split(",");
                if (cols.length >= 5) {
                    dates.push(cols[0]); // Date
                    temperature.push(parseFloat(cols[1])); // Temperature
                    rainfall.push(parseFloat(cols[2])); // Rainfall
                    edAdmissions.push(parseInt(cols[3])); // ED Admissions
                    icuAdmissions.push(parseInt(cols[4])); // ICU Admissions
                }
            });

            renderPlot();
        }

        // Add event listener for file upload
        document.getElementById("fileUpload").addEventListener("change", handleFileUpload);

        // Generate and render synthetic data by default
        generateSyntheticData();
        renderPlot();
    </script>
</body>
</html>
